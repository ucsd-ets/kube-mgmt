{{- if .Values.vs.enabled }}
apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: {{ .Values.vs.name }}
  namespace: {{ .Values.global.namespace }}
spec:
  host: {{ .Values.vs.host }}
{{- if .Values.ipPolicy.enabled }}
  policies:
  - name: {{ .Values.ipPolicy.name }}
{{- end }}
  tls:
    secret: {{ .Values.tls.name }}
  upstreams:
  - name: {{ .Values.global.fullnameOverride }}
    service: {{ .Values.global.fullnameOverride }}
    port: {{ .Values.opa_base.port }}
  routes:
    - path: {{ .Values.vs.path }}
      action:
        pass: {{ .Values.global.fullnameOverride }}
{{- end }}